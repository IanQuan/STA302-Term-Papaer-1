---
title: "My title"
subtitle: "My subtitle if needed"
author: 
  - Ian Quan
thanks: "Code and data are available at: LINK."
date: today
date-format: long
abstract: "First sentence. Second sentence. Third sentence. Fourth sentence."
format: pdf
number-sections: true
bibliography: references.bib
---

```{r}
#| include: false
#| warning: false
#| message: false

library(tidyverse)
library(palmerpenguins)
library(readr)

```

# Introduction

You can and should cross-reference sections and sub-sections.

The remainder of this paper is structured as follows. @sec-data....

# Data {#sec-data}

Variable of interest: Neighbourhood name where offence occurred using City of Toronto's new 158 neighbourhood structure, Crime rate from 2014 to 2023, including assault rate, auto theft rate, bike theft rate, break and enter rate, homicide rate, robbery rate, shooting rate, motor vehicles theft rate, theft rate

Some of our data is of penguins (@fig-bills), from @palmerpenguins.

```{r}
#| label: crime-rates-over-time
#| fig-cap: Bills of penguins
#| echo: false


average_crime_rate <-read_csv(here::here("outputs/data/average_crime_rate.csv"))

ggplot(average_crime_rate, aes(x = year)) +
  geom_line(aes(y = assault, color = "Assault"), linetype = "solid", size = 1, alpha = 0.8) +
  geom_line(aes(y = autotheft, color = "Auto Theft"), linetype = "solid", size = 1, alpha = 0.8) +
  geom_line(aes(y = biketheft, color = "Bike Theft"), linetype = "solid", size = 1, alpha = 0.8) +
  geom_line(aes(y = breakenter, color = "Break and Enter"), linetype = "solid", size = 1, alpha = 0.8) +
  geom_line(aes(y = homicide, color = "Homicide"), linetype = "solid", size = 1, alpha = 0.8) +
  geom_line(aes(y = robbery, color = "Robbery"), linetype = "solid", size = 1, alpha = 0.8) +
  geom_line(aes(y = shooting, color = "Shooting"), linetype = "solid", size = 1, alpha = 0.8) +
  geom_line(aes(y = theftover, color = "Theft Over"), linetype = "solid", size = 1, alpha = 0.8) +

  scale_color_manual(
    values = c(
      "Assault" = "blue",
      "Auto Theft" = "red",
      "Bike Theft" = "green",
      "Break and Enter" = "orange",
      "Homicide" = "purple",
      "Robbery" = "brown",
      "Shooting" = "pink",
      "Theft Over" = "magenta"
    ),
    name = "Crime Type",
    labels = c(
      "Assault", "Auto Theft", "Bike Theft", "Break and Enter",
      "Homicide", "Robbery", "Shooting", "Theft Over $5000"
    )
  ) +
  scale_size_continuous(name = "Line width", range = c(0.5, 2)) +

  # Customize plot labels and theme as needed
  labs(
    title = "Average Crime Rates over time in City of Toronto's new 158 neighbourhood ",
    x = "Year",
    y = "Average Crime Rate (%)"
  ) +
  theme_minimal() + 
  theme(
    plot.title = element_text(hjust = 0.1)  # Center the title
  )
```

Talk more about it.

And also planes (@fig-planes). (You can change the height and width, but don't worry about doing that until you have finished every other aspect of the paper - Quarto will try to make it look nice and the defaults usually work well once you have enough text.)

```{r}
#| label: toronto_population_densit_2023
#| fig-cap: Toronto population density in 2023
#| echo: false
#| warning: false
#| message: false
#| out.width: '70%'

knitr::include_graphics(here::here("outputs/plots/plot_population_2023.png"))
```

---
output:
  pdf_document:
    fig_width: 22
    fig_height: 26
---

```{r}
#| label: crime-rates-heat-map
#| fig-cap: Crime rate heat maps in Toronto
#| echo: false
#| out.width: '100%'
#| fig.align: "default"



crime_rate_columns <- c(
  "assault_rate_2023",
  "autotheft_rate_2023",
  "biketheft_rate_2023",
  "breakenter_rate_2023",
  "homicide_rate_2023",
  "robbery_rate_2023",
  "shooting_rate_2023",
  "theftfrommv_rate_2023",
  "theftover_rate_2023"
)

# Set up the layout for the plots
par(mfrow = c(3, 3), mar = c(0, 0, 0, 0), oma = c(0, 0, 0, 0))



# Read and plot 9 PNG images
for (i in 1:9) {
  # Read the PNG image
  img <- png::readPNG(here::here("outputs/plots", paste0("plot_", crime_rate_columns[i], ".png")))
  
  # Plot the image with resized dimensions
  plot(1, type = "n", axes = FALSE, xlab = "", ylab = "")
  rasterImage(img, 0.6, 0.7, 1.2, 1.3, interpolate = FALSE)
}
```



```{r}
#| label: top-20-area
#| fig-cap: Top 20 Neighbourhood's Average Crime Rates
#| echo: false
#| fig.align: "default"
#| out.width: '100%'

knitr::include_graphics(here::here("outputs/plots/plot_top_20_neighbourhood.png"))

```
# Results

Our results are summarized in @tbl-modelresults.

# Discussion

## First discussion point {#sec-first-point}

If my paper were 10 pages, then should be be at least 2.5 pages. The discussion is a chance to show off what you know and what you learnt from all this.

## Second discussion point

## Third discussion point

## Weaknesses and next steps

Weaknesses and next steps should also be included.

\newpage

\appendix

# Appendix {.unnumbered}

# Additional data details

# Model details {#sec-model-details}

## Posterior predictive check

In @fig-ppcheckandposteriorvsprior-1 we implement a posterior predictive check. This shows...

In @fig-ppcheckandposteriorvsprior-2 we compare the posterior with the prior. This shows...

```{r}
#| eval: true
#| echo: false
#| message: false
#| warning: false
#| label: fig-ppcheckandposteriorvsprior
#| layout-ncol: 2
#| fig-cap: "Examining how the model fits, and is affected by, the data"
#| fig-subcap: ["Posterior prediction check", "Comparing the posterior with the prior"]

```

## Diagnostics

@fig-stanareyouokay-1 is a trace plot. It shows... This suggests...

@fig-stanareyouokay-2 is a Rhat plot. It shows... This suggests...

```{r}
#| echo: false
#| eval: true
#| message: false
#| warning: false
#| label: fig-stanareyouokay
#| fig-cap: "Checking the convergence of the MCMC algorithm"
#| fig-subcap: ["Trace plot", "Rhat plot"]
#| layout-ncol: 2


```

\newpage

# References
